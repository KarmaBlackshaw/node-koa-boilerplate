// store
const {{ pluralPascalCase name }} = require('@store/{{ pluralKebabCase name }}')

// utilities
const { createSearchQuery } = require('@utilities/search-query')

// libraries
const Joi = require('joi')

module.exports = ({ router }) => router
  .prefix('/{{ pluralKebabCase name }}')

  .get('/', async ctx => {
    const query = ctx.request.query
    const params = {
      ...createSearchQuery(query)
    }

    const list = await {{ pluralPascalCase name }}.list({
      ...params
    })

    const total = await {{ pluralPascalCase name }}.list({
      ...params,
      is_count: true
    })

    ctx.body = { total, list }
  })

  .get('/find', async ctx => {
    ctx.body = await {{ pluralPascalCase name }}.find(ctx.request.query)

    ctx.status = 200
  })

  .post('/', async ctx => {
    const schema = Joi.object({
      start_date: Joi.date()
        .optional(),
      end_date: Joi.date()
        .optional(),
      profit: Joi.number()
        .required()
    })

    const request = await schema.validateAsync(ctx.request.body)

    ctx.body = await {{ pluralPascalCase name }}.store({
      start_date: request.start_date,
      end_date: request.end_date,
      profit: request.profit
    })
  })

  .patch('/', async ctx => {
    const schema = Joi.object({
      id: Joi.number()
        .required()
    })

    const data = await schema.validateAsync(ctx.request.body)

    ctx.body = await {{ pluralPascalCase name }}.modify(data.id, {})
  })

  .delete('/', async ctx => {
    const schema = Joi.object({
      id: Joi.number()
        .required()
    })

    const data = await schema.validateAsync(ctx.request.body)

    await {{ pluralPascalCase name }}.modify(data.id, {
      deleted_at: new Date()
    })

    ctx.status = 200
  })
